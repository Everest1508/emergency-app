<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Driver Tracker</title>

    <link rel="icon" href="https://api.iconify.design/mdi:car.svg?color=purple" type="image/svg+xml" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/frappe-charts/dist/frappe-charts.min.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-gray-100 font-sans">
    {% include 'components/sidebar.html' %}
    
    <div id="map" class="w-full h-screen z-10"></div>

    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Load drivers data passed from the Django view
            const drivers = JSON.parse('{{ drivers_json|escapejs }}');

            const map = L.map('map').setView([19.988480, 73.770598], 11); // Change default location to admin city

            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',
            }).addTo(map);

            drivers.forEach(driver => {
                const marker = L.marker([driver.lat, driver.lng]).addTo(map);

                // Bind popup
                marker.bindPopup(`
                    <div style="min-width: 150px">
                        <strong>${driver.name}</strong><br />
                        Status: <span style="color:${driver.status === 'online' ? 'green' : 'red'}">${driver.status}</span><br />
                        Duty: ${driver.dutyStatus}
                    </div>
                `);
            });
        });
    </script>
</body>
</html>
